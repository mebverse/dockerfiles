FROM python:3.12

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    DJANGO_ENV=test

WORKDIR /app

# Example change: install extra debug tools
RUN apt-get update && \
    apt-get install -y postgresql-client libpq-dev postgresql-contrib curl nano

COPY requirements.in /app/

RUN pip install --upgrade "pip<25" && \
    pip install "pip-tools==7.5.1"

# For test environment, install Django debug tools
RUN pip-compile requirements.in && \
    pip install --no-cache-dir -r requirements.txt \
    django-debug-toolbar

COPY . /app/

# Print a message so logs clearly show which Dockerfile was used
RUN echo "ðŸš€ Built using Dockerfile.test" > /dockerfile-info.txt

# Run collectstatic differently / skip if you want
RUN python manage.py collectstatic --noinput

EXPOSE 80

CMD ["gunicorn", "mysite.wsgi:application", "--bind", "0.0.0.0:80"]
